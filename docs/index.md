# Overview

<div style="text-align: center;">
<img src="./assets/logo.png" width="400px">
</div>

Argo CD Diff Preview is a tool that renders the diff between two branches in a Git repository. It is designed to render manifests generated by Argo CD, providing a clear and concise view of the changes between two branches. It operates similarly to Atlantis for Terraform, creating a plan that outlines the proposed changes.

### 3 Example Pull Requests:
- [Helm Example | Internal Chart](https://github.com/dag-andersen/argocd-diff-preview/pull/16)
- [Helm example | External Chart: Nginx](https://github.com/dag-andersen/argocd-diff-preview/pull/15)
- [Kustomize Example](https://github.com/dag-andersen/argocd-diff-preview/pull/12)

---

![](./assets/example-4.png)

## Overview

![](./assets/flow_dark.png)

The safest way to make changes to your Helm Charts and Kustomize Overlays in your GitOps repository is to let Argo CD render them for you. This can be done by spinning up an ephemeral cluster in your automated pipelines. Since the diff is rendered by Argo CD itself, it is as accurate as possible.

In short, the tool:

1. Spins up a local cluster and installs Argo CD
2. Applies your Applications (patched to point to the main branch and the PR branch)
3. Extracts the rendered manifests
4. Generates a diff and outputs it as Markdown/HTML

â†’ [**Read the full breakdown**](./how-it-works.md)

## Features

- **Accurate diffs** - Renders manifests using Argo CD itself, so the diff is as accurate as possible
- **Complete isolation** - No access to your real cluster or Argo CD instance required
- **Run locally** - Test changes before opening a pull request
- **Private repos & charts** - Works with private Git repositories and Helm charts
- **Multi-source applications** - Full support for Argo CD multi-source apps
- **ApplicationSets** - Supports List, Git, Matrix, Merge, and other generators
- **Config Management Plugins** - Use custom CMPs via Argo CD Helm chart configuration
- **External chart visibility** - See exactly what changed when updating a Helm chart version (e.g., Nginx). [PR example](https://github.com/dag-andersen/argocd-diff-preview/pull/15)
- **Smart filtering** - Filter applications by file path, regex, labels, or change detection. [Documentation](./application-selection.md)
- **Diff noise filtering** - Ignore version bumps, generated values, or other noisy changes with `--diff-ignore`
- **Multiple output formats** - Generates Markdown (for PR comments), HTML, and full YAML manifests
- **Reuse existing clusters** - Skip cluster creation by connecting to a pre-installed Argo CD instance (~60s faster). [Documentation](./reusing-clusters/connecting.md)
- **Dry run mode** - Preview which applications would be rendered without creating a cluster

## Why do we need this?

In the Kubernetes world, we often use templating tools like Kustomize and Helm to generate our Kubernetes manifests. These tools make maintaining and streamlining configuration easier across applications and environments. However, they also make it harder to visualize the application's actual configuration in the cluster.

Mentally parsing Helm templates and Kustomize patches is hard without rendering the actual output. Thus, making mistakes while modifying an application's configuration is relatively easy.

In the field of GitOps and infrastructure as code, all configurations are checked into Git and modified through PRs. The code changes in the PR are reviewed by a human, who needs to understand the changes made to the configuration. This is hard when the configuration is generated through templating tools like Kustomize and Helm.

## ArgoCon 2024 Talk

<img align="right" src="./assets/ArgoConLogoOrange.svg" width="30%"> `argocd-diff-preview` was presented at ArgoCon 2024 in Utah, US. The talk covered current tools and methods for visualizing code changes in GitOps workflows and introduced this new approach, which uses ephemeral clusters to render accurate diffs directly on your pull requests.

- Talk description: [GitOps Safety: Rendering Accurate ArgoCD Diffs Directly on Pull Requests](
https://colocatedeventsna2024.sched.com/event/1izsL/gitops-safety-rendering-accurate-argocd-diffs-directly-on-pull-requests-dag-bjerre-andersen-visma-regina-voloshin-octopus-deploy)
- Talk recording: [YouTube](https://youtu.be/3aeP__qPSms)

## Contributing

We welcome contributions to ArgoCD Diff Preview! Whether you want to fix bugs, add new features, or improve documentation, your help is appreciated.

Please check out our [contribution guidelines](https://github.com/dag-andersen/argocd-diff-preview/blob/main/CONTRIBUTING.md) for details on how to set up your development environment, run tests, and submit changes.